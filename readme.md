# Заметки по THREE.js

## Содержание
* [Вступление](#вступление)
  * [Проект WEBVKUBE](#проект-webvkube)
    * [Урок 1. Введение](#урок-1-введение)
    * [Урок 2. Модули, импорт, экспорт](#урок-2-модули-импорт-экспорт)
      * [Экспорт и импорт](#экспорт-и-импорт)
      * [Подключение модулей и вызов на странице](#подключение-модулей-и-вызов-на-странице)
    * [Урок 3. Создаем простую сцену](#урок-3-создаем-простую-сцену)
* [Документация](#документация)
  * [Объекты в целом](#объекты-в-целом)
  * [Меш](#меш)
    * [Геометрия](#геометрия)
    * [Материал](#материал)
  * [Сцена](#сцена)
  * [Камера](#камера)
  * [Свет](#свет)
  * [Рендер](#рендер)

## Вступление
[Вернуться к содержанию][toc]

Изначально в данном документе были заметки по бесплатному курсу по THREE.js от [webvkube]. Но позже я решил добавить информацию и по другим материалам. Еще есть заметки/перевод документации. Перевод вольный, сверяйте все с официальной документацией.  

К бесплатному курсу был ограничен доступ. Ссылки оставлю на всякий случай. Если что - все вопросы в группу автора. Материал хороший! :thumbsup:

### Проект WEBVKUBE

* [Канал][youtube_main_channel] уроков на Youtube.
* [Группа ВК][vk_kurspothreejs] 

Список уроков на Youtube :
* Урок 01. [Введение.](https://www.youtube.com/watch?v=DRiVzLca3xc)
* Урок 02. [Модули, импорт, экспорт.](https://www.youtube.com/watch?v=scAiW8rzvLc)
* Урок 03. [Создаем простую сцену.](https://www.youtube.com/watch?v=ECAYu1mZUzM)
* Урок 04. [Объект3D, его параметры и методы.](https://www.youtube.com/watch?v=dADyZorNysU)
* Урок 05. [Перемещение и векторы.](https://www.youtube.com/watch?v=MJUOLZyI7iE)
* Урок 06. [Поворот объектов.](https://www.youtube.com/watch?v=NYqh5flYKEo)
* Урок 07. [Геометрия объекта.](https://www.youtube.com/watch?v=lm7uXWyziFs)
* Урок 08. [Материалы.](https://www.youtube.com/watch?v=aOkmujuzO2M)
* Урок 09. [Текстуры, свет, камеры.](https://www.youtube.com/watch?v=0FW3kyuRyyw)
* Урок 10. [Ресайз, Взаимодействие с объектом.](https://www.youtube.com/watch?v=yHQugrtmkH4)
* Урок 11. [Создаем платформер часть 1.](https://www.youtube.com/watch?v=gXwsuVicjV4)
* Урок 12. [Состояния. Создаем платформер часть 2.](https://www.youtube.com/watch?v=ap2Y3G6RE0c)
* Урок 13. [Создаем платформер часть 3. ИИ Проверка нанесения урона.](https://www.youtube.com/watch?v=y5ZlQeQOtAg)

##### VS Code Intellisense для THREE.js

Я использую VS Code и Intellisense для библиотеки THREE.js заработал автоматически после импорта библиотеки. Но на всякий случай могу предложить почитать [здесь][vscode_intellisense] как сделать себе в редакторе Intellisense для THREE.js, если вдруг автоматически не заработал.

#### Урок 1. Введение
[Вернуться к содержанию][toc]

Официальный сайт проекта [THREE.js][three_js_site].

Скачать библиотеку three.js с [GitHub][three_js_github_build].

#### Урок 2. Модули, импорт, экспорт
[Вернуться к содержанию][toc]

Лучше организовать код и работу с ним через модули.

##### Экспорт и импорт
[Вернуться к содержанию][toc]

* Если **в файле только один класс, объект или переменная**, то экспорт можно делать через слово `default`, а при импорте просто указываем переменную, куда складываем импортированные данные.

```javascript
// файл ./js/data.js

export default 1; // например, экспортируем просто число

// или
export default class{}; // может быть класс

// или
export default {}; // может быть объект
```

```javascript
// файл ./js/app.js

import a from './js/data.js';
alert(a);
export default true;
```

* Если **в файле несколько переменных, объектов или классов**, то надо их сначала объявить, потом через { } экспортировать. При импорте тоже нужно указать фигурные скобки { }.

```javascript
// файл ./js/data.js

let a = 1;
export {a};
```

```javascript
// файл ./js/app.js

import {a} from './js/data.js';
alert(a);
export default true;
```

* Если **экспортируем несколько переменных**, указываем их через запятую , . Импортируем также через через запятую , .

```javascript
// файл ./js/data.js

let a = 1;
let b = 3:
export {a, b};
```

```javascript
// файл ./js/app.js

import {a, b} from './js/data.js';
alert(a);
alert(b);
export default true;
```

* Если нужно **экспортировать все**, то указываем через `* as` и указываем имя родителя.

```javascript
// файл ./js/app.js

import * as data from './js/data.js';
alert(data.a);
alert(data.b);
export default true;
```

* Иногда модули нужны только **для объединения других модулей** модулей. Тогда вместо `import` пишем `export`, а импорт также делам через `* as`.

```javascript
// файл ./js/data.js

let a = 1;
let b = 3:
export {a, b};
```

```javascript
// файл ./js/app.js

export * from './js/data.js'; // в данном случае файл является передаточным звеном
```

```html
<!-- файл ./index.html -->

<script type="module">
  import * as app from './js/app.js';
  console.log(app.a, app.b); 
</script>
``` 

* Также, **для объединении нескольких файлов** нужно просто их добавить.

```javascript
// файл ./js/app.js

export * from './js/data.js';
export * from './js/data1.js';
export * from './js/data2.js';
export * from './js/data3.js';
// и т.д.
```

##### Подключение модулей и вызов на странице
[Вернуться к содержанию][toc]

* **Подключение приложения** в текущем подходе осуществляется в index.html:

```html
<!-- файл ./index.html -->

<script type="module">
  import app from './js/app.js';
</script>
``` 

В данном случае, `app` может быть любым другим словом.

#### Урок 3. Создаем простую сцену
[Вернуться к содержанию][toc]

Все 3d базируется на нескольких понятиях, о которых нужно помнить при создании приложения. Это:
1. Объект:
    * Геометрия;
    * Материал.
2. Сцена.
3. Камера.
4. Свет.
5. Рендер.

Модуль приложения описан в файле app.js. Пока что там экспортируются только 2 дефолтные функции: **init** для инициализации проекта и **update** для постоянной прорисовки (рендера) картинки. В index.html этот модуль подключается и там же вызывается инициализация приложения. Обрати внимание на то, что <span id="lesson-3-renderer-recursion-update-function">рекурсивная функция рендерера update</span> построена так: в ней сначала запоминается контекст выполнения функции, который нам нужен, а только потом будет рекурсия нашего контекста. Это в данном примере так. Дальше посмотрим, может что поменяется. Дополнительно в index.html для body задаются отступы 0 и overflow: hidden, т.к. почему-то вылезает скролбар все время. Возможно, у других это не так.

```html
<!-- файл index.html -->

<style>
  body {
    margin: 0;
    overflow: hidden;
  }
</style>

<script type="module">
  import app from './js/app.js';
  app.init();
</script>
```

```javascript
// файл app.js

export default {

  // функция инициализации приложения
  init: function () {
    // тут объявляются все объекты, сцены, камеры, свет и т.д.
    this.update();
  },

  // функция прорисовки (обновления картинки)
  update: function () {
    let that = this; // здесь сохранили контекст выполнения
    this.renderer.render(this.scene, this.camera); // запустили рендерер
    requestAnimationFrame( function () {
      that.update();
    }); // рекурсивно вызвали функцию обновления
  }
};
```

## Документация
[Вернуться к содержанию][toc]

[Офиициальная документация][three_js_doc_site] по THREE.js

Здесь коротко собираю информацию, чтобы не забыть про объекты, параметры функций, варианты и т.д.

### Объекты в целом
[Вернуться к содержанию][toc]

Вообще-то, объектом может быть все в приложении: меш, камера, источник света, сцена. В свою очередь меш это объект, который состоит из геометрии и материала.

Все объекты наследуются от класса `Object3D`.

* **Object3D**

**Cвойства**

```javascript
// Вложенные объекты / массив с потомками (Array)
.children

// Имя объекта (String)
.name

// Родитель / ссылка на объект по иерархии выше
.parent

// Позиция (Vector3)
.position.x // а также .y и .z

// Поворот (Euler или Quarenion)
.rotation.x // а также .y и .z (в радианах)

// Масштаб (Vector3)
.scale.x // а также .y и .z

// Видимость объекта в сцене (Boolean, def: true)
.visible
```

**Методы**

```javascript
// Добавить объект в объект
.add(Object);

// Отбрасывать тени (Boolean, def: flase)
.castShadow();

// Клонировать объект (геометрия и материал остаются прежними)
.clone()

// Поиск объекта по id
.getObjectById(Integer)

// Поиск объекта по имени
.getObjectByName(String)
```

### Меш
[Вернуться к содержанию][toc]

Наследуется от `Object3D`.

* **Меш**

Меш включает в себя геометрию и материал. Это то, что мы увидим как объект в сцене. Например, стул, дерево, мяч и т.д. - все это будут мэши со свое геометрией и материалами.

```javascript
let mesh = new THREE.Mesh(геометрия, материал);
```

#### Геометрия
[Вернуться к содержанию][toc]

* **Куб**

Может быть неравносторонним. Размеры в числах. Принимаем, что 1 = 1 м.

```javascript
let boxGeometry = new THREE.BoxGeometry(ширина, высота, глубина);
```

#### Материал
[Вернуться к содержанию][toc]

* **Стандартный материал**

Просто покрывает мэш в заданный цвет. В параметр материала передаются свойства в виде объекта { }. Задаются свойства цвета, шераховатости, прозрачности, металлизированности, карты нормалей, AO и т.д. Формат цвета `0x000000` - последние 6 цифр это RRGGBB в 16-ричной системе счисления от 0 до f.

<!-- TODO добавь описание параметров -->
```javascript
let materialStandart = new THREE.MeshStandartMaterial({
  color: 0x000000,
  //...
});
```

### Сцена
[Вернуться к содержанию][toc]

* **Сцена**

Наследуется от `Object3D`.

Сцена как коробка, в которую складывают все объекты и в которой разворачиваются все действия. Перед запуском отрисовки (рендером), надо поместить все объекты, включая меши, свет, камеры. Без добавления в сцену объектов они просто не будут отрисовываться.

```javascript
let scene = new THREE.Scene();

// добавляем в сцену объекты
scene.add(перечисляем что добавляем);
```

### Камера
[Вернуться к содержанию][toc]

Наследуется от `Object3D`.

* **Перспективная** камера

Наследуется от `Object3D -> Camera`.

Показывает картинку с учетом перспективы. Так можно понять глубину картинки. Объекты при приближении и удалении меняют размер. Есть перспектива. Понятно, да? :wink: В параметры передаем угол обзора (FOV, field of view) бери 60 или 75 для начала; отношение сторон для отображения бери window.innerWidth / window.innerHeight; ближнюю границу клиппинга бери 0.1; дальнюю границу клиппинга бери 100 для начала.

```javascript
let cameraPersp = new THREE.PerspectiveCamera(угол обзора, 
  отншение сторон для отображения, 
  ближняя граница прорисовки, 
  дальняя граница прорисовки);
```

* **Ортографическая** камера

Наследуется от `Object3D -> Camera`.

Это для отображения плоских сцен. 2d, например. Здесь не будет видно перспективы. Объекты на разном расстоянии будут одинакового размера.
<!-- TODO опиши параметры ортографической камеры и какие для начала брать значения -->

```javascript
let cameraOrto = new THREE.OrtographicCamera();
```

### Свет
[Вернуться к содержанию][toc] 

Наследуется от `Object3D`.

* **Гемисферический** источник света.

Наследуется от `Object3D -> Light`.

Свет будет подаваться сверху и снизу. Цвета верхнего и нижнего света в формате `0x000000`; интенсивность в числах бери 1 для начала.

```javascript
let lightHemi = new THREE.HemisphereLight(цвет верхнего света, цвет нижнего света, интенсивность источника света) 
```

### Рендер
[Вернуться к содержанию][toc]

Рендер. Рендерер. Прорисовыватель всего того, что ты построил. Делает картинку. Для статичной картинки его можно вызвать один раз. Для работы приложения его нужно вызывать каждый кадр, т.е. чтобы каждый кадр перерисовывалась сцена. Обычно это 60 кадров в секунду (60 fps). Тогда рендерер помещают либо в таймер, либо в рекурсивную функцию. 

* **WebGLRenderer**

Рендер на технологии WebGL. В примере ниже рендереру задают размеры как DOM-элементу и добавляют на страницу в body. По поводу рекурсии посмотри еще как это в уроке 2 было [сделано](#lesson-3-renderer-recursion-update-function).

```javascript
let renderer = new THREE.WebGLRenderer();

// задаем размер рендерера (канваса)
renderer.setSize(window.innerWidth, window.innerHeight);
// и добавляем его на страницу
document.body.appendChild(renderer.domElement);
```

```javascript
// вариант реализации рекурсивной функции рендера приложения

function update() {
  // здесь описывается что должно происходить каждый кадр:
  // анимация, перемещение объектов и т.д. 
  renderer.render(сцена, камера)
  requestAnimationFrame( function () { 
    update();
  });
};
```







<!-- Ссылки -->
[toc]: #содержание
[webvkube]: http://webvkube.ru
[youtube_main_channel]: https://www.youtube.com/channel/UCBnK0ae8Wvu_TEkWmOIwWBw
[vk_kurspothreejs]: https://vk.com/kurspothreejs
[vscode_intellisense]: http://shrekshao.github.io/2016/06/20/vscode-01/
[three_js_site]: http://threejs.org
[three_js_github_build]: https://github.com/mrdoob/three.js/tree/dev/build
[three_js_doc_site]: https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene